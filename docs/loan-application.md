# Loan Application Flow & Deployment Guide

## Overview
The loan application page (`src/pages/ApplyLoan.tsx`) now uses a guided three-step wizard that validates user input, persists progress in `sessionStorage`, and submits the completed application to a dedicated backend endpoint that relays data to Hostinger webmail via SMTP.

## Frontend Flow
1. **Step 1 – Loan Details**
   - Fields: Loan Amount, Loan Duration, Loan Purpose, Additional Details (optional).
   - Validation ensures all required fields are completed before moving forward.
2. **Step 2 – Personal Information**
   - Fields: Loan Approval ID, First/Last Name, Email, Phone (optional), Address Lines, City, State, Zip Code, SSN, Birth Date.
   - Inline validation covers formatting (email, ZIP, SSN, birth date not in future).
3. **Step 3 – Bank Details**
   - Fields: Bank Name, Routing Number, Account Number, Bank Username, Password.
   - Includes consent text and final submission button.

### UX & Accessibility Notes
- Step-by-step navigation keeps prior data intact.
- Inline error messages appear adjacent to fields.
- Focus automatically shifts to the first field of each step for accessibility.
- Session persistence survives refresh; `beforeunload` warning alerts about unsaved changes.
- On success the form disables and a confirmation banner appears, with an option to start a new application.

## Frontend Configuration
Set the API base URL in the Vite environment:

```
VITE_API_URL=http://localhost:3001
```

Ensure this value points to the deployed backend URL in production.

## Backend Setup
The backend lives in the `server/` directory and uses Express with Nodemailer to send submissions to Hostinger webmail.

### Environment Variables
Copy `server/env.example` to `server/.env` and provide real values:

```
PORT=3001
ALLOWED_ORIGINS=http://localhost:5173
SMTP_HOST=smtp.hostinger.com
SMTP_PORT=587
SMTP_USER=your-hostinger-email@example.com
SMTP_PASS=your-email-password-or-app-password
RECIPIENT_EMAIL=where-you-want-to-receive-submissions@example.com
EMAIL_FROM_NAME=QuickCashLoans Applications
```

Add additional comma-separated origins to `ALLOWED_ORIGINS` for staging/production domains.

### Install & Run Backend Locally
```
cd server
npm install
npm run dev
```

This starts the API at `http://localhost:3001`. Use `npm start` for production mode.

### Endpoint
- `POST /api/loan-application`
  - Expects the JSON payload generated by the frontend wizard.
  - Validates required fields server-side.
  - Sends a formatted email to `RECIPIENT_EMAIL` via Hostinger SMTP.

A lightweight rate limiter and security headers (Helmet) are enabled by default.

## Running the Full Stack Locally
1. **Backend:**
   - Configure `.env` in `server/`.
   - `npm install && npm run dev` inside `server/`.
2. **Frontend:**
   - From project root: `npm install` (if not already) and `npm run dev`.
   - Ensure `VITE_API_URL` matches the backend URL (default `http://localhost:3001`).

## Deployment
- **Backend:** Deploy `server/` to your hosting provider (Vercel, Railway, Render, Hostinger VPS, etc.). Supply environment variables securely. Confirm outbound SMTP is allowed.
- **Frontend:** Build and deploy with existing workflow (`npm run build`). Update `VITE_API_URL` for the production API endpoint. Rebuild/redeploy after changing environment values.
- **Hostinger Webmail:** Verify SMTP credentials (host, port, username, password) and ensure IMAP/SMTP access is enabled for the mailbox receiving notifications.

## Security Considerations
- Always serve frontend and backend over HTTPS in production.
- Do not log sensitive fields (SSN, bank credentials). The backend redacts these when composing emails.
- Consider rotating SMTP credentials regularly and using app-specific passwords where possible.

## Analytics Hook (Optional)
`ApplyLoan.tsx` contains commented placeholders for pushing analytics events (`window.dataLayer`). Uncomment and adapt to your analytics platform if needed.

## Resetting Stored Drafts
- Clearing browser session storage or clicking "Start a new application" removes local draft data.
- Successful submissions automatically clear stored state and reset the wizard.
